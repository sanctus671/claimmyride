(self.webpackChunkclaimmyride=self.webpackChunkclaimmyride||[]).push([[475],{475:function(e,t,i){"use strict";i.r(t),i.d(t,{AddVehiclePageModule:function(){return A}});var n=i(1116),o=i(1462),r=i(8809),l=i(578),c=i(9609),a=i(5803),h=i(2827),s=i(6282),u=i(9899),g=i(303);function d(e,t){1&e&&a._UZ(0,"ion-spinner")}function p(e,t){1&e&&(a.TgZ(0,"p",18),a._uU(1,"Success! Your vehicle was found and the details have been prepopulated below."),a.qZA())}function v(e,t){1&e&&(a.TgZ(0,"p",18),a._uU(1,"Your vehicle was not found. Please enter your vehicle details below."),a.qZA())}function f(e,t){if(1&e){var i=a.EpF();a.TgZ(0,"div"),a.YNc(1,p,2,0,"p",13),a.YNc(2,v,2,0,"p",13),a.TgZ(3,"ion-item"),a.TgZ(4,"ion-label",6),a._uU(5,"Vehicle Make"),a.qZA(),a.TgZ(6,"ion-input",7),a.NdJ("ngModelChange",function(e){return a.CHM(i),a.oxw().vehicle.make=e}),a.qZA(),a.qZA(),a.TgZ(7,"ion-item"),a.TgZ(8,"ion-label",6),a._uU(9,"Vehicle Model"),a.qZA(),a.TgZ(10,"ion-input",7),a.NdJ("ngModelChange",function(e){return a.CHM(i),a.oxw().vehicle.model=e}),a.qZA(),a.qZA(),a.TgZ(11,"ion-item"),a.TgZ(12,"ion-label",6),a._uU(13,"Vehicle Year"),a.qZA(),a.TgZ(14,"ion-input",7),a.NdJ("ngModelChange",function(e){return a.CHM(i),a.oxw().vehicle.year=e}),a.qZA(),a.qZA(),a.TgZ(15,"ion-item"),a.TgZ(16,"ion-label",6),a._uU(17,"Fuel Type"),a.qZA(),a.TgZ(18,"ion-select",14),a.NdJ("ngModelChange",function(e){return a.CHM(i),a.oxw().vehicle.fuel_type=e})("ionChange",function(){return a.CHM(i),a.oxw().updateTaxRates()}),a.TgZ(19,"ion-select-option",15),a._uU(20,"Petrol or Diesel"),a.qZA(),a.TgZ(21,"ion-select-option",16),a._uU(22,"Petrol Hybrid"),a.qZA(),a.TgZ(23,"ion-select-option",17),a._uU(24,"Electric"),a.qZA(),a.qZA(),a.qZA(),a.TgZ(25,"ion-item"),a.TgZ(26,"ion-label",6),a._uU(27,"Vehicle Odometer Reading"),a.qZA(),a.TgZ(28,"ion-input",7),a.NdJ("ngModelChange",function(e){return a.CHM(i),a.oxw().vehicle.odometer=e}),a.qZA(),a.qZA(),a.qZA()}if(2&e){var n=a.oxw();a.xp6(1),a.Q6J("ngIf",n.vehicle.found),a.xp6(1),a.Q6J("ngIf",!n.vehicle.found),a.xp6(4),a.Q6J("ngModel",n.vehicle.make),a.xp6(4),a.Q6J("ngModel",n.vehicle.model),a.xp6(4),a.Q6J("ngModel",n.vehicle.year),a.xp6(4),a.Q6J("ngModel",n.vehicle.fuel_type),a.xp6(10),a.Q6J("ngModel",n.vehicle.odometer)}}function _(e,t){if(1&e&&(a.TgZ(0,"ion-select-option",22),a._uU(1),a.qZA()),2&e){var i=t.$implicit;a.Q6J("value",i.id),a.xp6(1),a.Oqu(i.name)}}function m(e,t){if(1&e){var i=a.EpF();a.TgZ(0,"div"),a.TgZ(1,"ion-item"),a.TgZ(2,"ion-label",6),a._uU(3,"Vehicle Type Name"),a.qZA(),a.TgZ(4,"ion-input",7),a.NdJ("ngModelChange",function(e){return a.CHM(i),a.oxw(2).vehicle.vehicle_type_name=e}),a.qZA(),a.qZA(),a.qZA()}if(2&e){var n=a.oxw(2);a.xp6(4),a.Q6J("ngModel",n.vehicle.vehicle_type_name)}}function x(e,t){if(1&e){var i=a.EpF();a.TgZ(0,"div"),a.TgZ(1,"ion-item"),a.TgZ(2,"ion-label",6),a._uU(3,"Usage Type"),a.qZA(),a.TgZ(4,"ion-select",19),a.NdJ("ngModelChange",function(e){return a.CHM(i),a.oxw().vehicle.vehicle_type_id=e}),a.YNc(5,_,2,2,"ion-select-option",20),a.TgZ(6,"ion-select-option",21),a._uU(7,"Add Vehicle Type"),a.qZA(),a.qZA(),a.qZA(),a.YNc(8,m,5,1,"div",9),a.qZA()}if(2&e){var n=a.oxw();a.xp6(4),a.Q6J("ngModel",n.vehicle.vehicle_type_id),a.xp6(1),a.Q6J("ngForOf",n.vehicleTypes),a.xp6(3),a.Q6J("ngIf","create"===n.vehicle.vehicle_type_id)}}function Z(e,t){if(1&e&&(a.TgZ(0,"p",23),a._uU(1),a.qZA()),2&e){var i=a.oxw();a.xp6(1),a.Oqu(i.vehicle.error)}}function y(e,t){1&e&&a._UZ(0,"ion-spinner")}var C=[{path:"",component:function(){function e(e,t,i,n,o,r,l,a){var h=this;this.driverService=e,this.vehicleService=t,this.navCtrl=i,this.alertCtrl=n,this.activatedRoute=o,this.iab=r,this.authenticationService=l,this.router=a,this.vehicle={km_tax_rate1:.83,km_tax_rate2:.31},this.vehicleService.getVehicleTypes().then(function(e){h.vehicleTypes=e});var s=parseInt(this.activatedRoute.snapshot.params.driverId);this.vehicle.driver_id=s,this.tax={tier_one_petrol:.83,tier_one_hybrid:.83,tier_one_electric:.83,tier_two_petrol:.31,tier_two_hybrid:.18,tier_two_electric:.1},this.vehicleService.getTaxRates().then(function(e){h.tax=e,h.user.tax&&(h.tax=JSON.parse(h.user.tax))}),this.user={},this.authenticationService.retreiveUserData().then(function(e){h.user=e,h.user.tax&&(h.tax=JSON.parse(h.user.tax),h.vehicle.km_tax_rate1=h.tax.tier_one_petrol,h.vehicle.km_tax_rate2=h.tax.tier_two_petrol)}),this.authenticationService.getUserData().subscribe(function(e){h.user=e}),this.vehicles=[],this.getVehicles(),this.lastAddedCount=0,this.vehicleService.getLastAdded().then(function(e){if(e){var t=JSON.parse(e),i=c(),n=i.add(1,"hour"),o=c(t.date);o.isBefore(n)&&o.isAfter(i)&&(h.lastAddedCount=t.count)}})}return e.prototype.ngOnInit=function(){},e.prototype.getVehicles=function(){var e=this;this.vehicleService.getVehicles().then(function(t){e.vehicles=t})},e.prototype.openLink=function(e){this.iab.create(e,"_system")},e.prototype.lookupRegistration=function(){var e=this;if(this.vehicle.registration){if(this.lastAddedCount>4)return this.alertCtrl.create({header:"Error",message:"You have exceeded the allowable vehicle lookups over the last hour. Please manually enter your vehicle details or try again in 60 minutes.",buttons:[{text:"Dismiss",role:"cancel",handler:function(e){}}]}).then(function(e){e.present()}),this.vehicle.lookupCompleted=!0,this.vehicle.found=!1,void(this.vehicle.registrationLoading=!1);this.vehicle.registrationLoading=!0,this.vehicle.registration=this.vehicle.registration.toUpperCase(),this.vehicleService.getVehicleDetails(this.vehicle.registration).then(function(t){e.vehicle.make=t.make,e.vehicle.model=t.model,e.vehicle.fuel_type=e.getFuelType(parseInt(t.fuel_type)),e.vehicle.year=t.year_of_manufacture,e.vehicle.odometer=t.latest_odometer_reading,e.updateTaxRates(),e.vehicle.lookupCompleted=!0,e.vehicle.found=!0,e.vehicle.registrationLoading=!1}).catch(function(t){e.vehicle.lookupCompleted=!0,e.vehicle.found=!1,e.vehicle.registrationLoading=!1}),this.lastAddedCount+=1,this.vehicleService.saveLastAdded(this.lastAddedCount,c().format("YYYY-MM-DD hh:mm:ss"))}},e.prototype.getFuelType=function(e){var t={1:"Petrol",2:"Diesel",3:"CNG",4:"LPG",5:"Electric",6:"Other",7:"Petrol Hybrid",8:"Diesel Hybrid",9:"Petrol Electric Hybrid",10:"Diesel electric Hybrid",11:"Plug-in petrol hybrid",12:"Plug-in diesel hybrid",13:"Electric - petrol extended",14:"Electric - diesel extended",15:"Electric hydrogen fuel cell",16:"Electric other fuel cell",17:"Plug-in hydrogen fuel cell hybrid",18:"Plug-in other fuel cell hybrid",91:"Petrol Hybrid",92:"Plug-in Hybrid-Petrol",93:"Hybrid",94:"Diesel Hybrid",95:"Electric Hybrid",96:"Plug-in Hybrid-Diesel",97:"Electric (fuel cell)"}[e];return t?(t=t.toLowerCase()).indexOf("hybrid")>-1||t.indexOf("extended")>-1?"hybrid":t.indexOf("electric")>-1?"electric":"petrol":""},e.prototype.updateTaxRates=function(){"petrol"===this.vehicle.fuel_type?(this.vehicle.km_tax_rate1=this.tax.tier_one_petrol,this.vehicle.km_tax_rate2=this.tax.tier_two_petrol):"hybrid"===this.vehicle.fuel_type?(this.vehicle.km_tax_rate1=this.tax.tier_one_hybrid,this.vehicle.km_tax_rate2=this.tax.tier_two_hybrid):"electric"===this.vehicle.fuel_type&&(this.vehicle.km_tax_rate1=this.tax.tier_one_electric,this.vehicle.km_tax_rate2=this.tax.tier_two_electric)},e.prototype.create=function(){var e=this;this.user&&!this.user.premium_enabled&&this.vehicles.length>1?this.alertCtrl.create({header:"Error",message:"You have exceeded your free allowance of 2 vehicles. Please upgrade to premium to add more vehicles.",buttons:[{text:"Dismiss",role:"cancel",handler:function(e){}},{text:"Upgrade to premium",handler:function(t){e.router.navigate(["/upgrade"])}}]}).then(function(e){e.present()}):(this.vehicle.loading=!0,this.vehicle.name=this.vehicle.make+" "+this.vehicle.registration,this.vehicleService.createVehicle(this.vehicle).then(function(){e.vehicle.loading=!1,e.driverService.setDriversUpdated(),e.navCtrl.back()}).catch(function(){e.vehicle.loading=!1,e.alertCtrl.create({header:"Error",message:"There was an error while creating your vehicle. Please try again.",buttons:[{text:"Dismiss",role:"cancel",handler:function(e){}}]}).then(function(e){e.present()})}))},e.\u0275fac=function(t){return new(t||e)(a.Y36(h.F),a.Y36(s.f),a.Y36(r.SH),a.Y36(r.Br),a.Y36(l.gz),a.Y36(u.i),a.Y36(g.$),a.Y36(l.F0))},e.\u0275cmp=a.Xpm({type:e,selectors:[["app-add-vehicle"]],decls:22,vars:8,consts:[["color","light"],["slot","start"],["defaultHref","/tabs/track","color","primary"],["color","primary"],[1,"signup"],[1,"signup__form"],["position","floating"],["clearInput","","type","text",3,"ngModel","ngModelChange"],["color","primary","expand","full","shape","round",1,"find-vehicle",3,"disabled","click"],[4,"ngIf"],["class","signup__form__error",4,"ngIf"],[1,"signup-footer"],["color","primary","expand","full","shape","round",1,"signup-footer__button",3,"disabled","click"],["class","vehicle-result",4,"ngIf"],[3,"ngModel","ngModelChange","ionChange"],["value","petrol"],["value","hybrid"],["value","electric"],[1,"vehicle-result"],[3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["value","create"],[3,"value"],[1,"signup__form__error"]],template:function(e,t){1&e&&(a.TgZ(0,"ion-header"),a.TgZ(1,"ion-toolbar",0),a.TgZ(2,"ion-buttons",1),a._UZ(3,"ion-back-button",2),a.qZA(),a.TgZ(4,"ion-title",3),a._uU(5,"Add Vehicle"),a.qZA(),a.qZA(),a.qZA(),a.TgZ(6,"ion-content",4),a.TgZ(7,"ion-list",5),a.TgZ(8,"ion-item"),a.TgZ(9,"ion-label",6),a._uU(10,"Please enter vehicle registration number"),a.qZA(),a.TgZ(11,"ion-input",7),a.NdJ("ngModelChange",function(e){return t.vehicle.registration=e}),a.qZA(),a.qZA(),a.TgZ(12,"ion-button",8),a.NdJ("click",function(){return t.lookupRegistration()}),a._uU(13," Find Vehicle "),a.YNc(14,d,1,0,"ion-spinner",9),a.qZA(),a.YNc(15,f,29,7,"div",9),a.YNc(16,x,9,3,"div",9),a.YNc(17,Z,2,1,"p",10),a.qZA(),a.qZA(),a.TgZ(18,"ion-footer",11),a.TgZ(19,"ion-button",12),a.NdJ("click",function(){return t.create()}),a._uU(20," Add Vehicle "),a.YNc(21,y,1,0,"ion-spinner",9),a.qZA(),a.qZA()),2&e&&(a.xp6(11),a.Q6J("ngModel",t.vehicle.registration),a.xp6(1),a.Q6J("disabled",t.vehicle.registrationLoading||!t.vehicle.registration),a.xp6(2),a.Q6J("ngIf",t.vehicle.registrationLoading),a.xp6(1),a.Q6J("ngIf",t.vehicle.registration&&t.vehicle.lookupCompleted&&!t.vehicle.registrationLoading),a.xp6(1),a.Q6J("ngIf",!1),a.xp6(1),a.Q6J("ngIf",t.vehicle.error),a.xp6(2),a.Q6J("disabled",t.vehicle.loading||!t.vehicle.make||!t.vehicle.registration),a.xp6(2),a.Q6J("ngIf",t.vehicle.loading))},directives:[r.Gu,r.sr,r.Sm,r.oU,r.cs,r.wd,r.W2,r.q_,r.Ie,r.Q$,r.pK,r.j9,o.JJ,o.On,r.YG,n.O5,r.fr,r.PQ,r.t9,r.QI,r.n0,n.sg],styles:[".signup[_ngcontent-%COMP%]   .signup__form[_ngcontent-%COMP%]   .vehicle-result[_ngcontent-%COMP%]{padding:0 15px}.signup[_ngcontent-%COMP%]   .signup__form[_ngcontent-%COMP%]   .find-vehicle[_ngcontent-%COMP%]{margin-top:20px}.signup[_ngcontent-%COMP%]   .signup__form[_ngcontent-%COMP%]   .find-vehicle[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]{font-size:14px;width:14px;height:14px;margin-left:5px}.signup[_ngcontent-%COMP%]   .signup__form[_ngcontent-%COMP%]   .signup__form__error[_ngcontent-%COMP%]{color:red;font-size:12px;line-height:16px;text-align:Center}.signup[_ngcontent-%COMP%]   .signup__form[_ngcontent-%COMP%]   .signup__form__login[_ngcontent-%COMP%]{margin-top:40px;text-align:Center}.signup[_ngcontent-%COMP%]   .input-sub-text[_ngcontent-%COMP%]{font-size:12px;margin:0 0 10px}.signup-footer[_ngcontent-%COMP%]{background-color:#fff}.signup-footer[_ngcontent-%COMP%]:before{display:none}.signup-footer[_ngcontent-%COMP%]   .signup-footer__button[_ngcontent-%COMP%]   ion-spinner[_ngcontent-%COMP%]{font-size:14px;width:14px;height:14px;margin-left:5px}"]}),e}()}],b=function(){function e(){}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=a.oAB({type:e}),e.\u0275inj=a.cJS({imports:[[l.Bz.forChild(C)],l.Bz]}),e}(),A=function(){function e(){}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=a.oAB({type:e}),e.\u0275inj=a.cJS({imports:[[n.ez,o.u5,r.Pc,b]]}),e}()}}]);